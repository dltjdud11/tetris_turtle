<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ë°”ì¼ í…ŒíŠ¸ë¦¬ìŠ¤ ê²Œì„ (ë‹¨ì¼ íŒŒì¼)</title>
    
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* ìƒë‹¨ë¶€í„° ë°°ì¹˜ */
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding-top: 20px;
            background-color: #333;
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden; 
            user-select: none;
            box-sizing: border-box;
        }

        .game-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background-color: #222;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #game-board {
            display: grid;
            grid-template-rows: repeat(20, 1fr); 
            grid-template-columns: repeat(10, 1fr);
            width: 300px; /* ê¸°ë³¸ í¬ê¸° */
            height: 600px;
            border: 3px solid #ccc;
            background-color: #111;
        }

        .cell {
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            border: 1px solid #000;
        }

        /* í…ŒíŠ¸ë¡œë¯¸ë…¸ ë¸”ë¡ ìƒ‰ìƒ */
        .T { background-color: purple; border-color: #6a0080; }
        .L { background-color: orange; border-color: #cc6600; }
        .J { background-color: blue; border-color: #000080; }
        .S { background-color: green; border-color: #004d00; }
        .Z { background-color: red; border-color: #800000; }
        .I { background-color: cyan; border-color: #008080; }
        .O { background-color: yellow; border-color: #808000; }

        .info-panel {
            width: 300px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            font-size: 1.2em;
        }
        
        #start-button {
            padding: 10px 15px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        #start-button:hover {
            background-color: #0056b3;
        }

        /* --- ëª¨ë°”ì¼ ì»¨íŠ¸ë¡¤ ìŠ¤íƒ€ì¼ë§ --- */
        .controls {
            display: flex;
            justify-content: space-around;
            width: 100%;
            padding: 15px 0;
        }

        .controls button {
            padding: 15px 25px;
            font-size: 24px;
            background-color: #444;
            color: white;
            border: 2px solid #666;
            border-radius: 10px;
            cursor: pointer;
            touch-action: manipulation; 
            flex-grow: 1; 
            margin: 0 5px;
            /* ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ ê°„ê²© ì¡°ì • */
            min-width: 60px;
            height: 60px;
        }

        .controls button:active {
            background-color: #666;
        }

        /* ëª¨ë°”ì¼ í™”ë©´ ìµœì í™” */
        @media (max-width: 600px) {
            #game-board, .info-panel {
                width: 90vw; 
                max-width: 300px;
            }
            #game-board {
                height: calc(90vw * 2); 
                max-height: 600px;
            }
            .controls {
                width: 90vw;
                max-width: 320px;
            }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div class="info-panel">
            <p>SCORE: <span id="score">0</span></p>
            <button id="start-button">START</button>
        </div>
        
        <div id="game-board">
            </div>
        
        <div class="controls">
            <button id="left">â¬…ï¸</button>
            <button id="rotate">ğŸ”„</button>
            <button id="right">â¡ï¸</button>
            <button id="down">â¬‡ï¸</button>
        </div>
    </div>
    
    <script>
        // --- ê²Œì„ ì„¤ì • ---
        const COLS = 10;
        const ROWS = 20;
        let score = 0;
        let gameBoard = [];
        let currentTetromino;
        let currentRotation = 0;
        let currentPosition = 4;
        let timerId = null;

        const boardElement = document.getElementById('game-board');
        const scoreElement = document.getElementById('score');
        const startButton = document.getElementById('start-button');
        const controls = {
            left: document.getElementById('left'),
            rotate: document.getElementById('rotate'),
            right: document.getElementById('right'),
            down: document.getElementById('down'),
        };

        // --- í…ŒíŠ¸ë¡œë¯¸ë…¸ ëª¨ì–‘ ì •ì˜ ---
        const TETROMINOS = [
            [[1, COLS + 1, COLS * 2 + 1, 2], [COLS, COLS * 2, COLS * 2 + 1, COLS * 2 + 2], [1, COLS + 1, COLS * 2 + 1, COLS * 2], [COLS, COLS + 1, COLS + 2, COLS * 2 + 2]], // L
            [[1, COLS + 1, COLS * 2 + 1, 0], [COLS, COLS * 2, COLS + 1, COLS + 2], [1, COLS + 1, COLS * 2 + 1, COLS * 2 + 2], [COLS + 2, COLS * 2, COLS * 2 + 1, COLS * 2 + 2]], // J
            [[1, COLS, COLS + 1, COLS + 2], [1, COLS + 1, COLS * 2 + 1, COLS + 2], [COLS, COLS + 1, COLS + 2, COLS * 2 + 1], [1, COLS, COLS + 1, COLS * 2 + 1]], // T
            [[COLS + 1, COLS + 2, COLS * 2, COLS * 2 + 1], [0, COLS, COLS + 1, COLS * 2 + 1]], // S
            [[COLS, COLS + 1, COLS * 2 + 1, COLS * 2 + 2], [1, COLS, COLS + 1, COLS * 2]], // Z
            [[1, COLS + 1, COLS * 2 + 1, COLS * 3 + 1], [COLS, COLS + 1, COLS + 2, COLS + 3]], // I
            [[0, 1, COLS, COLS + 1]] // O
        ];

        const TETROMINO_NAMES = ['L', 'J', 'T', 'S', 'Z', 'I', 'O'];

        // --- ë³´ë“œ ì´ˆê¸°í™” ë° ë Œë”ë§ ---
        function createBoard() {
            boardElement.innerHTML = '';
            gameBoard = [];
            for (let i = 0; i < COLS * ROWS; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                boardElement.appendChild(cell);
                gameBoard.push(cell); 
            }
        }

        // --- ë¸”ë¡ ìƒì„± ---
        function generateTetromino() {
            const randomIndex = Math.floor(Math.random() * TETROMINOS.length);
            currentTetromino = TETROMINOS[randomIndex];
            currentRotation = 0;
            currentPosition = 4;

            // ê²Œì„ ì˜¤ë²„ ì²´í¬: ìƒˆ ë¸”ë¡ ìƒì„± ìœ„ì¹˜ì— ì´ë¯¸ ë¸”ë¡ì´ ìˆìœ¼ë©´ ê²Œì„ ì˜¤ë²„
            if (checkCollision(currentPosition)) {
                gameOver();
                return false;
            }
            draw();
            return true;
        }

        // --- ë¸”ë¡ ê·¸ë¦¬ê¸°/ì§€ìš°ê¸° ---
        function draw() {
            const name = TETROMINO_NAMES[TETROMINOS.indexOf(currentTetromino)];
            currentTetromino[currentRotation].forEach(index => {
                const targetIndex = currentPosition + index;
                if (gameBoard[targetIndex]) {
                    gameBoard[targetIndex].classList.add(name);
                }
            });
        }

        function undraw() {
            const name = TETROMINO_NAMES[TETROMINOS.indexOf(currentTetromino)];
            currentTetromino[currentRotation].forEach(index => {
                const targetIndex = currentPosition + index;
                if (gameBoard[targetIndex]) {
                    gameBoard[targetIndex].classList.remove(name);
                }
            });
        }

        // --- ì¶©ëŒ ê°ì§€ ---
        function checkCollision(nextPosition, nextRotation = currentRotation) {
            return currentTetromino[nextRotation].some(index => {
                const targetIndex = nextPosition + index;
                
                // 1. ë³´ë“œ ë°”ë‹¥ì„ ë„˜ì—ˆëŠ”ì§€
                if (targetIndex >= COLS * ROWS) return true;
                
                // 2. ë³´ë“œ ì¢Œìš° ê²½ê³„ë¥¼ ë„˜ì—ˆëŠ”ì§€
                const isLeftEdge = (currentPosition + index) % COLS === 0 && (index + nextPosition) % COLS === COLS - 1;
                const isRightEdge = (currentPosition + index) % COLS === COLS - 1 && (index + nextPosition) % COLS === 0;

                if (isLeftEdge || isRightEdge) return true;

                // 3. ì´ë¯¸ ì±„ì›Œì§„ ì…€ì— ì¶©ëŒí•˜ëŠ”ì§€ (í´ë˜ìŠ¤ê°€ 'cell' ì´ì™¸ì— ë‹¤ë¥¸ í´ë˜ìŠ¤(ìƒ‰ìƒ)ê°€ ìˆëŠ”ì§€)
                if (targetIndex >= 0 && gameBoard[targetIndex] && gameBoard[targetIndex].classList.length > 1) return true;
                
                return false;
            });
        }
        
        // --- ë¸”ë¡ ì´ë™ ë¡œì§ ---
        function move(direction) {
            if (!timerId) return;
            undraw();
            let newPosition = currentPosition + direction;

            // ë²½ ì¶©ëŒ ì²´í¬ (ì¢Œ/ìš°)
            const isLeft = currentTetromino[currentRotation].some(index => (currentPosition + index) % COOLS === 0) && direction === -1;
            const isRight = currentTetromino[currentRotation].some(index => (currentPosition + index) % COLS === COLS - 1) && direction === 1;

            if (isLeft || isRight) {
                newPosition = currentPosition;
            }

            if (!checkCollision(newPosition)) {
                currentPosition = newPosition;
            }
            draw();
        }

        // --- ë¸”ë¡ íšŒì „ ë¡œì§ ---
        function rotate() {
            if (!timerId) return;
            undraw();
            const nextRotation = (currentRotation + 1) % currentTetromino.length;

            if (!checkCollision(currentPosition, nextRotation)) {
                currentRotation = nextRotation;
            }
            draw();
        }

        // --- ë¸”ë¡ í•˜ê°• ë¡œì§ ---
        function fall() {
            undraw();
            let newPosition = currentPosition + COLS;

            if (checkCollision(newPosition)) {
                // ì¶©ëŒí•˜ë©´ ë¸”ë¡ ê³ ì •
                freeze();
                checkLines();
                generateTetromino(); // ìƒˆ ë¸”ë¡ ìƒì„±
            } else {
                currentPosition = newPosition;
            }
            draw();
        }

        // --- ë¸”ë¡ ê³ ì • ---
        function freeze() {
            const name = TETROMINO_NAMES[TETROMINOS.indexOf(currentTetromino)];
            currentTetromino[currentRotation].forEach(index => {
                if (gameBoard[currentPosition + index]) {
                    gameBoard[currentPosition + index].classList.add(name);
                }
            });
        }

        // --- ì¤„ ì œê±° ë° ì ìˆ˜ ê³„ì‚° (ê°œì„ ëœ ë¡œì§) ---
        function checkLines() {
            let linesCleared = 0;
            
            for (let i = 0; i < ROWS; i++) {
                const start = i * COLS;
                const rowCells = gameBoard.slice(start, start + COLS);
                
                // í•´ë‹¹ ì¤„ì˜ ëª¨ë“  ì…€ì´ ì±„ì›Œì ¸ ìˆëŠ”ì§€ í™•ì¸ (í´ë˜ìŠ¤ ê¸¸ì´ê°€ 1ë³´ë‹¤ í¬ë©´ ì±„ì›Œì§„ ì…€)
                const isFull = rowCells.every(cell => cell.classList.length > 1);
                
                if (isFull) {
                    linesCleared++;
                    
                    // 1. í•´ë‹¹ ì¤„ì„ DOMê³¼ ë°°ì—´ì—ì„œ ì œê±°
                    rowCells.forEach(cell => boardElement.removeChild(cell));
                    const newRow = Array(COLS).fill(null).map(() => {
                        const cell = document.createElement('div');
                        cell.classList.add('cell');
                        return cell;
                    });

                    // 2. ì œê±°ëœ ì¤„ ìœ„ì— ìƒˆ ë¹ˆ ì¤„ì„ ì‚½ì… (ë°°ì—´ ë° DOM)
                    gameBoard.splice(start, COLS);
                    gameBoard.unshift(...newRow);

                    // 3. DOMì— ìƒˆë¡œìš´ ë°°ì—´ ë°˜ì˜ (ìƒë‹¨ì— ìƒˆ ì…€ì„ ì‚½ì…)
                    newRow.forEach(cell => boardElement.insertBefore(cell, boardElement.firstChild));
                }
            }
            
            if (linesCleared > 0) {
                score += linesCleared * 100;
                scoreElement.textContent = score;
            }
        }

        // --- ê²Œì„ ì˜¤ë²„ ---
        function gameOver() {
            clearInterval(timerId);
            timerId = null;
            startButton.textContent = 'RESTART';
            alert(`Game Over! Score: ${score}`);
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---

        // PC í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keydown', (e) => {
            if (!timerId) return; 

            if (e.key === 'ArrowLeft' || e.key === 'A' || e.key === 'a') move(-1);
            else if (e.key === 'ArrowRight' || e.key === 'D' || e.key === 'd') move(1);
            else if (e.key === 'ArrowDown' || e.key === 'S' || e.key === 's') fall();
            else if (e.key === 'ArrowUp' || e.key === 'W' || e.key === 'w') rotate();
        });

        // ëª¨ë°”ì¼/í„°ì¹˜ ë²„íŠ¼ ì´ë²¤íŠ¸ (touchstart ì‚¬ìš©: ë” ë¹ ë¥¸ ë°˜ì‘)
        controls.left.addEventListener('touchstart', (e) => { e.preventDefault(); move(-1); });
        controls.right.addEventListener('touchstart', (e) => { e.preventDefault(); move(1); });
        controls.down.addEventListener('touchstart', (e) => { e.preventDefault(); fall(); });
        controls.rotate.addEventListener('touchstart', (e) => { e.preventDefault(); rotate(); });


        // ê²Œì„ ì‹œì‘/ì¼ì‹œì •ì§€ ë²„íŠ¼
        startButton.addEventListener('click', () => {
            if (timerId) {
                // ì¼ì‹œ ì •ì§€
                clearInterval(timerId);
                timerId = null;
                startButton.textContent = 'RESUME';
            } else {
                if (startButton.textContent === 'START' || startButton.textContent === 'RESTART') {
                    // ìƒˆ ê²Œì„ ì‹œì‘
                    createBoard();
                    score = 0;
                    scoreElement.textContent = score;
                    generateTetromino();
                }
                
                // ê²Œì„ ì¬ê°œ ë˜ëŠ” ì‹œì‘
                timerId = setInterval(fall, 800); // í•˜ê°• ì†ë„: 0.8ì´ˆ
                startButton.textContent = 'PAUSE';
            }
        });

        // --- ì´ˆê¸° ì‹¤í–‰ ---
        createBoard();
    </script>
</body>
</html>
